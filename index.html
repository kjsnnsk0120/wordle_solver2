<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>wordleã‚’è§£ã„ã¦ãã‚Œã‚‹ãã‚“</title>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <py-script>
from pyodide.http import open_url
import json
api_endpoint = 'https://sfzdeisncmxwnvnzc2hje3k5ya0wfjma.lambda-url.ap-northeast-1.on.aws/'
pyscript.write("suggestedword","ãŠã™ã™ã‚å˜èªã¯ soare ã§ã™ã€‚")

tmp_int = [-1]
def client(*ags, **kws):
    input_word_a = Element("input_word_a")
    input_response_a = Element("input_response_a")
    input_word = input_word_a.element.value
    input_response = input_response_a.element.value

    if len(input_word) != 5:
        pyscript.write("leftwords","å…¥åŠ›ãŒãŠã‹ã—ã„ã‚ˆã†ã§ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
        return
    if len(input_response) != 5 or input_response.count("o") + input_response.count("-") + input_response.count("x") != 5:
        pyscript.write("leftwords","å…¥åŠ›ãŒãŠã‹ã—ã„ã‚ˆã†ã§ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
        return
    input_word_a.clear()
    input_response_a.clear()
    res = call_lambda(tmp_int[0],input_word,input_response)
    if int(res["number_of_candidates"]) == 0:
        pyscript.write("leftwords","å€™è£œå˜èªæ•°ãŒ0ã«ãªã‚Šã¾ã—ãŸã€‚ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚")
        pyscript.write("suggestedword","")
        yscript.write("candidates","")
    elif int(res["number_of_candidates"]) == 1:
        pyscript.write("leftwords","æ­£è§£ã¯ " + str(res["candidates"])+" ã§ã™ã€‚")
        pyscript.write("suggestedword","")
        pyscript.write("candidates","")
    else:
        pyscript.write("suggestedword","ãŠã™ã™ã‚å˜èªã¯ " + str(res["suggested_word"])+" ã§ã™ã€‚")
        if int(res["number_of_candidates"]) <= 10:
            pyscript.write("candidates","æ®‹ã£ã¦ã„ã‚‹å˜èªã¯ " + str(res["candidates"])+" ã§ã™ã€‚")
        pyscript.write("leftwords","æ®‹ã£ã¦ã„ã‚‹å˜èªã®æ•°ã¯ "+str(res["number_of_candidates"])+" å€‹ã§ã™ã€‚")

    tmp_int[0] = res["available_int"]

def gen_params(params):
    ans = ""
    for key in params:
        ans += str(key)
        ans += "="
        ans += str(params[key])
        ans += "&"
    return ans[:-1]

def call_lambda(word_list_int,input_word,input_response):
    params = {"word_list_int":str(word_list_int),
            "input_word": input_word,
            "input_response": input_response}
    
    url_with_params = f'{api_endpoint}?{gen_params(params)}'
    try:
        result = json.loads(open_url(url_with_params).read())
    except Exception as e:
        #pyscript.write("suggestedword","ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚")
        pyscript.write("suggestedword",e)
        tmp_int[0] = -1
        return
    return result
    </py-script>
    </head>
    <body>
        <h1><font color = "red"><big><marquee direction="right" behavior="alternate">wordleã‚’è§£ã„ã¦ãã‚Œã‚‹ãã‚“</marquee></big></font></h1>
        <p><label id='leftwords'></label></p>
        <p><label id='candidates'></label></p>
        <p><label id='suggestedword'>èª­ã¿è¾¼ã¿ä¸­â€¦â€¦</label></p>
        <br>
        <label><strong>å…¥åŠ›ã—ãŸå˜èª ğŸ‘‰ </strong><input id="input_word_a" class="border flex-1 mr-3 border-gray-300 p-2 rounded" type="text"></label>
        <label><strong>wordleã‹ã‚‰ã®å¿œç­” ğŸ‘‰</strong><input id="input_response_a" class="border flex-1 mr-3 border-gray-300 p-2 rounded" type="text"></label>
        <button id="new-task-btn" class="p-2 text-white bg-blue-600 border border-blue-600 rounded" type="submit" pys-onClick="client">
        ãŠã™ã™ã‚å˜èªã‚’è¡¨ç¤º ğŸ‘€
        </button>
        <br><br>

        <p>ã€å…¥åŠ›æ–¹æ³•ã€‘<br>ç·‘è‰²ã¯o(å°æ–‡å­—ã®ã‚ªãƒ¼)ã€é»„è‰²ã¯-(åŠè§’ã®ãƒãƒ¼)ã€ç°è‰²ã¯x(å°æ–‡å­—ã®ã‚¨ãƒƒã‚¯ã‚¹)ã§è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚<br>
        ä¾‹ï¼š <font color = "gray">â– â– </font><font color = "yellow">â– </font><font color = "green">â– â– </font>  â†’  xx-oo
        </p>
    </body>
</html>